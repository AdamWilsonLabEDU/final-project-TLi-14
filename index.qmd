---
title: "My Final Project Template"
author: Tianze Li
subtitle: Subtitle here if desired
date: today
date-format: long
---

# Introduction

\[\~ 200 words\]

Clearly stated background and questions / hypotheses / problems being addressed. Sets up the analysis in an interesting and compelling way. Include figures if you like.

# Materials and methods

\[\~ 200 words\]

Narrative: Clear narrative description of the data sources and methods. Includes data from at least two sources that were integrated / merged in R.

Code: The code associated with the project is well organized and easy to follow. Demonstrates mastery of R graphics and functions.

Data: The underlying data are publicly accessible via the web and downloaded/accessed within the Rmd script. If you want to use your own data, you must make it available on a website (e.g. Figshare) so that others are able to re-run your code.

You can do bullets like this:

-   The first most important thing
-   The second most important thing
-   The third most important thing

You can do numbers like this:

1.  The first most important thing
2.  The second most important thing
3.  The third most important thing

See <http://rmarkdown.rstudio.com/> for all the amazing things you can do.

Here's my first code chunk.

```{r}
# Load necessary libraries
# install.packages(c("terra", "geodata"))
install.packages("geodata")

library(terra)
library(geodata)

# Step 1: Download elevation data 
elevation <- worldclim_global(var = "elev", res = 2.5, path = tempdir())

# Check and visualize elevation data
print(elevation)
plot(elevation, main = "Global Elevation (2.5min)")

# Step 2: Download monthly climate data 

# Minimum temperature (Tmin)
tmin <- worldclim_global(var = "tmin", res = 2.5, path = tempdir())

# Mean temperature (Tmean)
tmean <- worldclim_global(var = "tavg", res = 2.5, path = tempdir())

# Maximum temperature (Tmax)
tmax <- worldclim_global(var = "tmax", res = 2.5, path = tempdir())

# Precipitation
precip <- worldclim_global(var = "prec", res = 2.5, path = tempdir())

# Solar radiation
solar <- worldclim_global(var = "srad", res = 2.5, path = tempdir())

# Wind speed
wind <- worldclim_global(var = "wind", res = 2.5, path = tempdir())

# Vapor pressure
vapor <- worldclim_global(var = "vapr", res = 2.5, path = tempdir())

# Step 3: Check and visualize individual climate variables
print(tmin)
plot(tmin[[1]], main = "January Minimum Temperature (Tmin)")

print(precip)
plot(precip[[1]], main = "January Precipitation")

print(solar)
plot(solar[[1]], main = "January Solar Radiation")

# Step 4: Combine all climate variables and elevation into a single raster stack
climate_stack <- c(elevation, tmin, tmean, tmax, precip, solar, wind, vapor)

# Check and visualize the combined raster stack
print(climate_stack)
plot(climate_stack[[1]], main = "Elevation and Climate Data Stack")
```

```{r, message=F, warning=F}
# Load necessary libraries
# install.packages("rnaturalearth")
library(terra)
library(rnaturalearth)

# Load or create the climate and elevation raster stack
# Assuming climate_stack has already been created

# Step 1: Download global land shapefile
land <- ne_download(scale = "medium", type = "land", category = "physical", returnclass = "sf")

# Step 2: Crop and mask raster stack to include only land areas
climate_stack_cropped <- crop(climate_stack, ext(land))  # Crop to land extent
climate_stack_land <- mask(climate_stack_cropped, vect(land))  # Mask to land areas

# Step 3: Visualize the results
plot(climate_stack_land[[1]], main = "Cropped and Masked Climate Data (Land Only)")
```

## Download and clean all required data

```{r}
# Install and load rgbif
# install.packages("rgbif")
library(rgbif)

# Define the species name
species_name <- "Takakia S.Hatt. & Inoue"

# Retrieve occurrence data
gbif_data <- occ_search(scientificName = species_name, limit = 2000)

# Extract longitude and latitude from the data
occurrences <- data.frame(
  lon = gbif_data$data$decimalLongitude,
  lat = gbif_data$data$decimalLatitude
)

# Remove rows with missing coordinates
occurrences_clean <- na.omit(occurrences)

# Remove duplicate coordinates
occurrences_unique <- occurrences_clean[!duplicated(occurrences_clean), ]

# Check the number of unique points
cat("Number of unique occurrence points:", nrow(occurrences_unique), "\n")

# Install and load ggplot2
# install.packages("ggplot2")
library(ggplot2)

# Plot unique occurrence points
ggplot() +
  geom_point(data = occurrences_unique, aes(x = lon, y = lat), color = "red", size = 1) +
  theme_minimal() +
  labs(title = "Unique Distribution Points of Takakia S.Hatt. & Inoue",
       x = "Longitude",
       y = "Latitude")

# Save the unique occurrence data to a CSV file
write.csv(occurrences_unique, "Takakia_Unique_Distribution_Data.csv", row.names = FALSE)
```

```{r, results='asis'}
data %>% 
  slice(1:10) %>% #show only 1:n rows
  kable(digits=2,align="c")%>% #make table and round to two digits
  kable_styling(bootstrap_options = 
                  c("striped", "hover", "condensed", "responsive")) #apply other formatting
```

Add any additional processing steps here.

# Results

\[\~200 words\]

Tables and figures (maps and other graphics) are carefully planned to convey the results of your analysis. Intense exploration and evidence of many trials and failures. The author looked at the data in many different ways before coming to the final presentation of the data.

Show tables, plots, etc. and describe them.

```{r, fig.width=6, fig.height=3, fig.cap="Map of completely random data"}
m <- leaflet(data) %>% 
  addTiles() %>% 
  addCircleMarkers(~x, ~y, radius = ~size,color = ~as.factor(category)) %>% 
  addPopups(~x[2], ~y[2], "Random popup")
m  # a map with the default OSM tile layer
```

```{r}
data %>% 
  ggplot(aes(x=x,y=y,col=category))+
  geom_point()
```

### Dygraphs Example

```{r}
library(dygraphs)
dygraph(nhtemp, main = "New Haven Temperatures") |> 
  dyRangeSelector(dateWindow = c("1920-01-01", "1960-01-01")) 
```

# Conclusions

\[\~200 words\]

Clear summary adequately describing the results and putting them in context. Discussion of further questions and ways to continue investigation.

# References

All sources are cited in a consistent manner
